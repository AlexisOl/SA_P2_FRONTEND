<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 p-4">

  <div class="lg:col-span-2 space-y-6">
    <div class="card flex justify-center mb-2">
      <p-fieldset legend="Gestion de salas">
        <p class="m-0">
          Para crear una nueva sala haga click en el boton
        </p>
        <p-button label="Nuevo cine" class="w-full" styleClass="w-full" (onClick)="this.verDialogoNuevaSala()" />
      </p-fieldset>
    </div>


    <!-- informacion general del cine-->
    <p-fieldset legend="Información general de hotel" class="mb-6">
      <div class="grid grid-cols-1 gap-3 p-2">
        <div class="flex">
          <span class="font-semibold w-32">Nombre:</span>
          <span>{{ this.cineEspecifico.nombre }}</span>
        </div>
        <div class="flex">
          <span class="font-semibold w-32">Teléfono:</span>
          <span>{{ this.cineEspecifico.telefono }}</span>
        </div>
        <div class="flex">
          <span class="font-semibold w-32">Dirección:</span>
          <span>{{ this.cineEspecifico.ubicacion }}</span>
        </div>
        <div class="flex">
          <span class="font-semibold w-32">Cartera:</span>
          <span>{{ this.cineEspecifico.cartera }}</span>
        </div>
        <div class="flex">
          <span class="font-semibold w-32">Ver dulceria del cine:</span>
          <span>
            <p-button label="Ver información" icon="pi pi-search" iconPos="right">

              <a [routerLink]="'/home/cine/' + this.cineEspecifico.id+'/snacks'" class="p-button p-component"
                style="text-decoration: none; color: inherit;">
              </a>
            </p-button>
          </span>
        </div>

      </div>
    </p-fieldset>

    <div class="card">
      <p-galleria [value]="anuncios" [autoPlay]="true" [circular]="true" styleClass="shadow-lg" [showThumbnails]="false"
        [responsiveOptions]="responsiveOptions" [numVisible]="5" [containerStyle]="{ 'max-width': '1400px' }">
        <ng-template #item let-item>
          @if (item.anuncio.tipo === "IMAGEN") {
          <div class="relative w-full h-full flex flex-col justify-center items-center bg-white p-6">
            <img [src]="item.materialAnuncio.linkimagen" class="max-w-full max-h-full object-contain rounded-lg"
              style="flex-shrink: 0;" />

            <div class="absolute inset-x-0 bottom-0 bg-black/80 p-5 text-center">
              <h4 class="font-bold text-xl text-white drop-shadow-2xl"
                style="color: white !important; text-shadow: 0 3px 10px rgba(0,0,0,0.9) !important;">
                {{ item.materialAnuncio.texto }}
              </h4>
            </div>
          </div>
          }

        </ng-template>

      </p-galleria>
    </div>


    <!-- Panel LISTADO -->
    <div class="h-full w-full mb-2">
      <div style="
            display: grid;
            grid-template-columns: repeat(2, minmax(280px, 1fr));
            gap: 1.5rem;
            padding: 1rem;
          ">
        @for (item of this.paginatedItems; track $index) {
        <p-card [style]="{
                width: '100%',
                overflow: 'hidden',
                borderRadius: '1rem',
                boxShadow: '0 4px 12px rgba(0,0,0,0.08)'
              }">

          <ng-template #title>
            <span style="font-weight: 600;"> {{ item.nombre }}</span>
            @if(item.promocion) {
            <p-tag severity="success" [value]='"En promoción: "+item.promocion.cantidad_descuento + "%"'></p-tag>

            }
          </ng-template>
          <ng-template #subtitle>
            <span style="color: #6b7280;">{{ item.tipoSala }}</span>

          </ng-template>
          <div class="flex gap-2 flex-wrap">
            <p-tag icon="pi pi-check" [severity]="item.validacionesSala.validar_calificaciones ? 'success' : 'danger'"
              [value]="item.validacionesSala.validar_calificaciones ? 'Calificaciones' : 'Sin calificaciones'"></p-tag>

            <p-tag icon="pi pi-comments" [severity]="item.validacionesSala.validar_comnentarios ? 'success' : 'danger'"
              [value]="item.validacionesSala.validar_comnentarios ? 'Comentarios' : 'Sin comentarios'"></p-tag>

            <p-tag icon="pi pi-eye" [severity]="item.validacionesSala.visible ? 'success' : 'danger'"
              [value]="item.validacionesSala.visible ? 'Visible' : 'No visible'"></p-tag>
          </div>


          <p>
            Filas: {{item.matrizAsientos.filas}} - Columnas: {{item.matrizAsientos.columnas}}
          </p>

            @if(item.validacionesSala.validar_calificaciones) {

          <div class="card flex justify-center">

            <p-rating [(ngModel)]="item.promedio_valoracion" [readonly]="true"></p-rating>

          </div>

        }
   <div class="botones-visibilidad grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
    <p-button 
      [label]="item.validacionesSala.visible ? 'Ocultar Anuncio' : 'Mostrar Anuncio'"
      [icon]="item.validacionesSala.visible ? 'pi pi-eye-slash' : 'pi pi-eye'"
      (onClick)="cambiarVisibilidad(item.id)"
      severity="secondary"
      class="w-full">
    </p-button>

    <p-button 
      [label]="item.validacionesSala.validar_comnentarios ? 'Ocultar Comentarios' : 'Mostrar Comentarios'"
      [icon]="item.validacionesSala.validar_comnentarios ? 'pi pi-comment' : 'pi pi-comments'"
      (onClick)="cambiarVisibilidadComentarios(item.id)"
      severity="info"
      class="w-full">
    </p-button>

    <p-button 
      [label]="item.validacionesSala.validar_calificaciones ? 'Ocultar Calificaciones' : 'Mostrar Calificaciones'"
      [icon]="item.validacionesSala.validar_calificaciones ? 'pi pi-star-fill' : 'pi pi-star'"
      (onClick)="cambiarVisibilidadCalificaciones(item.id)"
      severity="warn"
      class="w-full">
    </p-button>
  </div>
          <ng-template #footer>
            <div class="flex gap-4 mt-1">
            @if(item.validacionesSala.validar_comnentarios) {

              <p-button label="Ver comentarios" class="w-full" styleClass="w-full" (click)="showDialog(item.id)" />
            }
            @if(item.validacionesSala.visible) {

              <p-button label="Ver Cartelera" class="w-full" styleClass="w-full" (click)="showDialog(item.id)" />
            }
            </div>
          </ng-template>
        </p-card>
        }
      </div>

      <!-- paginator -->
      <div style="margin-top: 1rem; display: flex; justify-content: center;">
        <p-paginator [first]="first" [rows]="rows" [totalRecords]="items.length" [rowsPerPageOptions]="[3, 6, 10]"
          (onPageChange)="cambiarPagina($event)" />
      </div>
    </div>



    <!-- comentarios en una habitacion-->
    <!-- <div class="card flex justify-center">
  <p-dialog header="Comentarios" [modal]="true" [(visible)]="visible" [style]="{ width: '25rem' }">
    <div class="card flex justify-content-center">
      <p-accordion value="0">
        @for (item of this.listadoComentarios; track $index) {
        <p-accordion-panel value="$index">
          <p-accordion-header>
            <ng-template #toggleicon let-active="active">
              @if (active) {
              <i class="pi pi-minus"></i>
              } @else {
              <i class="pi pi-plus"></i>
              }
            </ng-template>
            <span class="flex items-center gap-2 w-full">
              <span class="font-bold whitespace-nowrap">Comentario No.{{$index}}</span>
              <p-badge value="{{item.puntuacion}}" class="ml-auto mr-2" />
            </span>
          </p-accordion-header>
          <p-accordion-content>
            <p class="m-0">
              {{item.comentario}}
            </p>
          </p-accordion-content>
        </p-accordion-panel>
        }



      </p-accordion>
    </div>
  </p-dialog>
</div> -->

  </div>
  <!-- COLUMNA 2: GALERÍA DE ANUNCIOS -->

  <div class="lg:col-span-1">
    <p-galleria [value]="anuncios" [autoPlay]="true" [circular]="true" [showThumbnails]="false"
      [responsiveOptions]="responsiveOptions" [numVisible]="1"
      [containerStyle]="{ 'max-width': '100%', height: '100%' }" styleClass="h-full">
      <ng-template #item let-item>
        @if (item.anuncio.tipo === "VIDEO") {

        <div class="relative w-full h-full flex flex-col justify-center items-center bg-gray-900 p-4">

          <video [src]="item.materialAnuncio.linkvideo" class="max-w-full max-h-full object-contain rounded-lg" autoplay muted loop
            playsinline preload="auto" webkit-playsinline="true"></video>


        </div>
        }


      </ng-template>
    </p-galleria>
  </div>

</div>

<!-- para nuevos cines-->

<div class="card flex justify-center">
  <p-dialog header="Nueva Sala" [modal]="true" [(visible)]="visibleNuevaSala" [style]="{ width: '35rem' }">

    <!-- Nombre Sala -->
    <div class="flex items-center gap-4 mb-3">
      <label for="nombre" class="font-semibold w-32">Nombre de Sala</label>
      <input pInputText id="nombre"
        class="flex-auto border border-gray-400 rounded px-2 py-1 focus:border-blue-500 focus:outline-none" type="text"
        [(ngModel)]="this.nombre" />
    </div>

    <!-- Tipo Sala -->
    <div class="flex items-center gap-4 mb-3">
      <label for="tipo" class="font-semibold w-32">Tipo de Sala</label>
      <p-select id="tipo" [options]="this.opcionesSala" placeholder="Seleccionar" [(ngModel)]="this.tipoSala" />

    </div>

    <!-- Matriz Asientos -->
    <h3 class="font-semibold mb-2">Asientos</h3>

    <div class="flex items-center gap-4 mb-3">
      <label for="filas" class="font-semibold w-32">Filas</label>
      <input pInputText id="filas" type="number" min="1" [(ngModel)]="this.filas"
        class="border border-gray-400 rounded px-2 py-1 flex-auto" />
    </div>

    <div class="flex items-center gap-4 mb-3">
      <label for="columnas" class="font-semibold w-32">Columnas</label>
      <input pInputText id="columnas" type="number" min="1" [(ngModel)]="this.columnas"
        class="border border-gray-400 rounded px-2 py-1 flex-auto" />
    </div>

    <!-- Validaciones -->
    <h3 class="font-semibold mb-2">Permisos sala</h3>

    <div class="flex items-center gap-3 mb-3">



      <p-checkbox inputId="comentarios" [(ngModel)]="this.validar_comnentarios" [binary]="true"></p-checkbox>
      <label for="comentarios">Permitir comentarios</label>
    </div>

    <div class="flex items-center gap-3 mb-3">
      <p-checkbox inputId="calificaciones" [(ngModel)]="this.validar_calificaciones" [binary]="true"></p-checkbox>
      <label for="calificaciones">Permitir calificaciones</label>
    </div>



    <!-- Botones -->
    <div class="flex justify-end gap-2 mt-4">
      <p-button label="Cancelar" severity="secondary" (click)="visibleNuevaSala = false" />
      <p-button label="Guardar" (click)="guardarSala()" />
    </div>

  </p-dialog>

</div>